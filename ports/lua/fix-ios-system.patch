diff --git a/src/loslib.c b/src/loslib.c
index de590c6..1a2eac0 100644
--- a/src/loslib.c
+++ b/src/loslib.c
@@ -3,7 +3,9 @@
 ** Standard Operating System library
 ** See Copyright Notice in lua.h
 */
-
+#if defined(__APPLE__)
+#include <TargetConditionals.h>
+#endif
 #define loslib_c
 #define LUA_LIB
 
@@ -140,7 +142,12 @@ static time_t l_checktime (lua_State *L, int arg) {
 
 static int os_execute (lua_State *L) {
   const char *cmd = luaL_optstring(L, 1, NULL);
+#if defined(__APPLE__) && !TARGET_OS_OSX
+  // system() is __IOS_PROHIBITED, __WATCHOS_PROHIBITED, and __TVOS_PROHIBITED.
+  int stat = 127; // error: shell execution failed
+#else
   int stat = system(cmd);
+#endif
   if (cmd != NULL)
     return luaL_execresult(L, stat);
   else {
